[workspace]
name = "anime-tiktok-reproducer"
version = "0.1.0"
description = "Web app to remaster TikToks by finding anime source clips and generating Premiere Pro projects"
channels = ["conda-forge"]
platforms = ["linux-64"]

# Request CUDA support for PyTorch
[system-requirements]
cuda = "12"

[dependencies]
# Python
python = ">=3.11,<3.13"

# FFmpeg for video processing
ffmpeg = ">=6.0"

# OpenCV from conda-forge
opencv = ">=4.10"

[pypi-dependencies]
# PyTorch with CUDA from PyPI (required for whisperx compatibility)
torch = { version = ">=2.8.0,<2.9.0", index = "https://download.pytorch.org/whl/cu128" }
torchaudio = { version = ">=2.8.0,<2.9.0", index = "https://download.pytorch.org/whl/cu128" }
torchvision = { version = ">=0.23.0", index = "https://download.pytorch.org/whl/cu128" }

# WhisperX (requires torch 2.8.x) - GPU accelerated transcription
whisperx = ">=3.7.6"

# FAISS for similarity search (CPU is fast enough for our use case)
faiss-cpu = ">=1.7.4"

# FastAPI + server
fastapi = ">=0.115.0"
uvicorn = { version = ">=0.32.0", extras = ["standard"] }
python-multipart = ">=0.0.18"
pydantic = ">=2.10.0"
pydantic-settings = ">=2.6.0"
aiofiles = ">=24.1.0"
requests = ">=2.32.0"

# Video/Audio processing
yt-dlp = ">=2026.2.4"
scenedetect = ">=0.6.5"
auto-editor = ">=28.0.0,<29.0.0"
opentimelineio = ">=0.18.1"
pillow = ">=10.0"
scipy = ">=1.10.0"
pydub = ">=0.25.1"

# CLI tools for anime_searcher
typer = ">=0.9"
rich = ">=13.0"

# NLP for determiner detection in SRT generation
spacy = ">=3.7.0"
fr-core-news-sm = { url = "https://github.com/explosion/spacy-models/releases/download/fr_core_news_sm-3.8.0/fr_core_news_sm-3.8.0-py3-none-any.whl" }
en-core-web-sm = { url = "https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.8.0/en_core_web_sm-3.8.0-py3-none-any.whl" }
es-core-news-sm = { url = "https://github.com/explosion/spacy-models/releases/download/es_core_news_sm-3.8.0/es_core_news_sm-3.8.0-py3-none-any.whl" }

# External platform integrations
google-api-python-client = ">=2.173.0"
google-auth = ">=2.40.0"
google-auth-httplib2 = ">=0.2.0"
google-auth-oauthlib = ">=1.2.2"

[feature.dev.pypi-dependencies]
pytest = ">=8.0.0"
pytest-asyncio = ">=0.24.0"
httpx = ">=0.28.0"

[environments]
default = { features = [], solve-group = "default" }
dev = { features = ["dev"], solve-group = "default" }

[tasks]
# Backend tasks
backend = { cmd = "uvicorn app.main:app --reload --host 127.0.0.1 --port 8000", cwd = "backend" }

# Frontend tasks (assumes fnm/npm available in PATH)
frontend = { cmd = "npm run dev", cwd = "frontend" }

# Combined dev server
dev = { depends-on = ["backend"] }

# Anime searcher CLI
anime-search = { cmd = "python -m anime_searcher.cli", cwd = "modules/anime_searcher" }

# Testing
test = { cmd = "pytest", cwd = "backend" }
test-verbose = { cmd = "pytest -v", cwd = "backend" }

# Index anime library
index-anime = { cmd = "python -m anime_searcher.cli index", cwd = "modules/anime_searcher" }
